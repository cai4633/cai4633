---
title: 逸辰音乐问题点
date: 2020-12-26 20:09:14
categories: 前端
tags:
---

今天在重构自己的项目时，发现了不少问题。总结归纳一下， 以便提高自己。

## 一、在 vue 项目现有的 stylus 代码中添加新的样式无效

在重构旧项目的过程中，我需要在现有 stylus 样式中添加一些 css。但是在添加 css 后，发现新样式不仅没有生效，反而会影响原有的样式。绞尽脑汁，最后发现是**stylus 缩进的格式**有问题。stylus 写法有很多种，常见的写法有 **{}** 或者**缩进**。当使用缩进写法时，**空格和 tab 不能混用**，否则会造成编译错误。
![stylus](/images/stylus_bug_reason.png)

## 二、多个 jsonp 请求问题

使用 jsonp 库**同时发送多个 jsonp**请求时，要保证 **callback 参数各不相同**，否则会导致 data 解析失败。

## 三、页面刷新 vuex 数据丢失

在项目中，我们很多时候不可避免的会使用 vuex 来管理全局状态。vuex 状态是保存在**运行时内存**中的。当**F5**页面刷新时，vuex 会被**新建并初始化**，这就导致了数据丢失。常用的解决办法就是借助 **sessionStorage** 或者 **localStorage** 缓存 vuex 中重要的数据。

```
//  in state.ts
const sessionDisc = window.sessionStorage.getItem("disc")
const state: any = {
  disc: sessionDisc ? JSON.parse(sessionDisc) : {},
}

//  in mutations.ts
  [types.SET_DISC](state: any, cd: any) {
    state.disc = cd
    window.sessionStorage.setItem("disc", JSON.stringify(cd))
  },
```
